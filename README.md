# Тестовое задание в AppSec Cloud Camp

# 2. Security code review.
## Часть 1. Security code review: GO.
### 1. Какие уязвимости присутствуют в этом фрагменте кода?
В данном фрагменте кода присутствуют уязвимости SQL-injection.
#

### 2. Указать строки, в которых присутствуют уязвимости.
```Go
searchQuery := r.URL.Query().Get("query")
```
В данной строке формируется SQL-запрос с использованием пользовательского ввода
```Go
query := fmt.Sprintf("SELECT * FROM products WHERE name LIKE '%%%s%%'", searchQuery)
```
В данной строке SQL-запрос формируется с помощью функции fmt.Sprintf, что может привести к инъекции SQL, если переменная searchQuery содержит вредоносные символы.
#

### 3. К каким последствиям может привести эксплуатация найденных уязвимостей злоумышленником?
Злоумышленник может осуществить атаку SQL-инъекции, в результате чего он может изменять, удалять или извлекать данные из БД. 
#

### 4. Описать способы исправления уязвимостей.
Для предотвращения SQL-инъекций можно использовать параметризованные или экранированные запросы. Это нужно чтобы разделять данные пользователя от кода SQL. В данном случае можно использовать параметризованные запросы для обработки пользовательского ввода.

Исправленная уязвимость:

```Go
query := "SELECT * FROM table_name WHERE name LIKE ?"
rows, err := db.Query(query, "%"+searchQuery+"%")
```

Этот подход позволяет использовать "?" для параметров запроса. 
#

### 5. Если уязвимость можно исправить несколькими способами, необходимо перечислить их, выбрать лучший по вашему мнению и аргументировать свой выбор.
В параметризированных запросах значения параметров передаются отдельно от самого запроса, что позволяет базе данных правильно обрабатывать входные данные и предотвращает возможность внедрения вредоносного SQL кода.
* При использовании параметризованных запросов библиотека SQL сама обрабатывает все входные данные таким образом, чтобы они не могли изменить структуру запроса.
* Параметризованные запросы чаще всего более читаемы, так как они явно показывают, где и какие данные вставляются в запрос.
* Использование параметризованных запросов является более производительным вариантом.
#

## Часть 2: Security code review: Python
## Пример №2.1
### 1. Указать строки, в которых присутствуют уязвимости.
```Go
output = Template('Hello ' + name + '! Your age is ' + age + '.').render()
```
#

### 2. К каким последствиям может привести эксплуатация данных уязвимостей злоумышленником?
Если пользовательский ввод содержит специальные символы, такие как фигурные скобки "{}" или операторы `Jinja2`, то он может быть интерпретирован как код `Template` и выполнен. Это может привести к выполнению вредоносного кода на сервере.
#

### 3. Описать способы исправления уязвимостей.
Для исправления этой уязвимости следует использовать безопасные методы форматирования строк. Можно использовать метод `safe_substitute` из модуля `string.Template` для безопасного форматирования строк:
```Go
output = Template('Hello $name! Your age is $age.').safe_substitute(name=name, age=age)
```

### P.S. app.run(debug=True)
В режиме отладки Flask предоставляет информацию об ошибках, в теории эта информация может быть использована злоумышленниками для получения дополнительных данных во время _«разведки»_. 
#

## Пример №2.2
### 1. Указать строки, в которых присутствуют уязвимости.
```python
cmd = 'nslookup ' + hostname
output = subprocess.check_output(cmd, shell=True, text=True)
```
#

### 2. К каким последствиям может привести эксплуатация данных уязвимостей злоумышленником?
Злоумышленник может использовать уязвимость для выполнения произвольных команд на сервере, что может привести к компрометации системы, краже данных или причинению иного вреда. (Для примера, можно просмотреть список файлов в текущем каталоге, если передать строку _«google.com; dir»_ или _«google.com; ls»_ в качестве `hostname`).
#

### 3. Описать способы исправления уязвимостей.
Уязвимость можно исправить при помощи экранирования запроса. К примеру можно использовать метод `quote()` модуля `shlex`:
```python
import shlex
cmd = 'nslookup ' + shlex.quote(hostname)
```
#

4. Если уязвимость можно исправить несколькими способами, необходимо перечислить их, выбрать лучший по вашему мнению и аргументировать свой выбор.
Если в данной задаче в поле hostname требуется настоящий IP адрес пользователя – можно воспользоваться библиотекой `request.remote_addr` библиотеки Flask
